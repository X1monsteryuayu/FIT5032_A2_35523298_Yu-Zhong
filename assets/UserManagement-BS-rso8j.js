import{_ as b,c as a,a as s,g as m,t as i,h as v,i as f,F as g,f as U,n as h,m as y,o as d,v as p}from"./index-CRzcarc7.js";const _={created(){this.loadUsers()},data(){return{searchQuery:"",showModal:!1,selectedUser:null,users:[],statistics:{total:0,active:0,new:0}}},computed:{filteredUsers(){const e=this.searchQuery.toLowerCase();return this.users.filter(t=>t.name.toLowerCase().includes(e)||t.email.toLowerCase().includes(e)||t.role.toLowerCase().includes(e))}},methods:{loadUsers(){this.users=y(),this.updateStatistics()},updateStatistics(){const e=this.users.length,t=this.users.filter(u=>u.active).length,c=this.users.filter(u=>{const l=new Date(u.joinedDate),n=new Date;return l.getMonth()===n.getMonth()&&l.getFullYear()===n.getFullYear()}).length;this.statistics={total:e,active:t,new:c}},updateUserRole(e){try{const t=JSON.parse(localStorage.getItem(e.email));t&&(t.role=e.role,localStorage.setItem(e.email,JSON.stringify(t)),alert("用户角色更新成功！"))}catch(t){console.error("Error updating user role:",t),alert("更新用户角色失败")}},toggleUserStatus(e){if(e.role==="admin"){alert("不能禁用管理员账户！");return}e.active=!e.active;try{const t=JSON.parse(localStorage.getItem(e.email));t&&(t.active=e.active,localStorage.setItem(e.email,JSON.stringify(t)),alert(e.active?"用户已启用":"用户已禁用"))}catch(t){console.error("Error updating user status:",t),alert("更新用户状态失败")}},viewUserDetails(e){this.selectedUser={...e},this.showModal=!0},closeModal(){this.showModal=!1,this.selectedUser=null},deleteUser(e){confirm("Are you sure you want to delete this user?")&&(this.users=this.users.filter(t=>t.id!==e),alert("User deleted successfully!"))}}},w={class:"user-management"},S={class:"container py-5"},C={class:"row g-4 mb-5"},x={class:"col-md-4"},M={class:"card updateUserRole(user) { if (user.role === 'admin' && user.id === this.currentUser?.email) { alert('不能更改自己的管理员角色！'); // 恢复原始角色 user.role = 'admin'; return; } if (updateUserRole(user.email, user.role)) { alert('用户角色更新成功！'); this.loadUsers(); // 重新加载用户列表 } else { alert('更新用户角色失败'); } }, toggleUserStatus(user) { if (user.role === 'admin') { alert('不能禁用管理员账户！'); return; } const newStatus = !user.active; if (updateUserStatus(user.email, newStatus)) { user.active = newStatus; alert(newStatus ? '用户已启用' : '用户已禁用'); } else { alert('更新用户状态失败'); } }, async deleteUser(id) { const user = this.users.find(u => u.id === id); if (!user) return; if (user.role === 'admin') { alert('不能删除管理员账户！'); return; } if (confirm('确定要删除此用户吗？')) { if (deleteUser(user.email)) { this.users = this.users.filter(u => u.id !== id); alert('用户删除成功！'); this.loadUsers(); // 重新加载用户列表 } else { alert('删除用户失败'); } } }ard"},k={class:"card-body"},D={class:"d-flex align-items-center"},L={class:"mb-0"},N={class:"col-md-4"},A={class:"card stat-card"},I={class:"card-body"},R={class:"d-flex align-items-center"},J={class:"mb-0"},j={class:"col-md-4"},E={class:"card stat-card"},V={class:"card-body"},B={class:"d-flex align-items-center"},F={class:"mb-0"},O={class:"card"},Q={class:"card-body"},T={class:"d-flex justify-content-between align-items-center mb-4"},Y={class:"search-box"},q={class:"table-responsive"},z={class:"table"},G=["onUpdate:modelValue","onChange"],H=["onClick"],K=["onClick"],P=["onClick"],W={class:"modal-dialog modal-lg"},X={class:"modal-content"},Z={class:"modal-header"},$={key:0,class:"modal-body"},ss={class:"row"},ts={class:"col-md-6"},es={class:"table"},ls={class:"col-md-6"},os={class:"table"},is={class:"modal-footer"},ns={key:0,class:"modal-backdrop fade show"};function rs(e,t,c,u,l,n){return d(),a("div",w,[s("div",S,[t[17]||(t[17]=s("h1",{class:"text-center mb-5"},"User Management",-1)),s("div",C,[s("div",x,[s("div",M,[s("div",k,[t[5]||(t[5]=s("h3",{class:"card-title"},"Total Users",-1)),s("div",D,[t[4]||(t[4]=s("i",{class:"bi bi-people fs-1 me-3 text-primary"},null,-1)),s("div",null,[s("h2",L,i(l.statistics.total),1),t[3]||(t[3]=s("small",{class:"text-muted"},"注册用户总数",-1))])])])])]),s("div",N,[s("div",A,[s("div",I,[t[8]||(t[8]=s("h3",{class:"card-title"},"Active Users",-1)),s("div",R,[t[7]||(t[7]=s("i",{class:"bi bi-person-check fs-1 me-3 text-success"},null,-1)),s("div",null,[s("h2",J,i(l.statistics.active),1),t[6]||(t[6]=s("small",{class:"text-muted"},"当前活跃用户",-1))])])])])]),s("div",j,[s("div",E,[s("div",V,[t[11]||(t[11]=s("h3",{class:"card-title"},"New Users",-1)),s("div",B,[t[10]||(t[10]=s("i",{class:"bi bi-person-plus fs-1 me-3 text-info"},null,-1)),s("div",null,[s("h2",F,i(l.statistics.new),1),t[9]||(t[9]=s("small",{class:"text-muted"},"本月新增",-1))])])])])])]),s("div",O,[s("div",Q,[s("div",T,[t[12]||(t[12]=s("h3",{class:"card-title mb-0"},"User List",-1)),s("div",Y,[v(s("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=o=>l.searchQuery=o),placeholder:"Search users..."},null,512),[[f,l.searchQuery]])])]),s("div",q,[s("table",z,[t[16]||(t[16]=s("thead",null,[s("tr",null,[s("th",null,"Name"),s("th",null,"Email"),s("th",null,"Role"),s("th",null,"Status"),s("th",null,"Joined Date"),s("th",null,"Actions")])],-1)),s("tbody",null,[(d(!0),a(g,null,U(n.filteredUsers,o=>(d(),a("tr",{key:o.id},[s("td",null,i(o.name),1),s("td",null,i(o.email),1),s("td",null,[v(s("select",{"onUpdate:modelValue":r=>o.role=r,class:"form-select form-select-sm",onChange:r=>n.updateUserRole(o)},t[13]||(t[13]=[s("option",{value:"user"},"User",-1),s("option",{value:"admin"},"Admin",-1)]),40,G),[[p,o.role]])]),s("td",null,[s("span",{class:h(["badge",o.active?"bg-success":"bg-secondary"]),style:{cursor:"pointer"},onClick:r=>n.toggleUserStatus(o)},i(o.active?"Active":"Inactive"),11,H)]),s("td",null,i(o.joinedDate),1),s("td",null,[s("button",{class:"btn btn-sm btn-outline-primary me-2",onClick:r=>n.viewUserDetails(o)},t[14]||(t[14]=[s("i",{class:"bi bi-eye"},null,-1)]),8,K),s("button",{class:"btn btn-sm btn-outline-danger",onClick:r=>n.deleteUser(o.id)},t[15]||(t[15]=[s("i",{class:"bi bi-trash"},null,-1)]),8,P)])]))),128))])])])])])]),s("div",{class:h(["modal fade",{"show d-block":l.showModal}]),tabindex:"-1"},[s("div",W,[s("div",X,[s("div",Z,[t[18]||(t[18]=s("h5",{class:"modal-title"},"User Details",-1)),s("button",{type:"button",class:"btn-close",onClick:t[1]||(t[1]=(...o)=>n.closeModal&&n.closeModal(...o))})]),l.selectedUser?(d(),a("div",$,[s("div",ss,[s("div",ts,[t[24]||(t[24]=s("h6",null,"Basic Information",-1)),s("table",es,[s("tr",null,[t[19]||(t[19]=s("th",null,"Name:",-1)),s("td",null,i(l.selectedUser.name),1)]),s("tr",null,[t[20]||(t[20]=s("th",null,"Email:",-1)),s("td",null,i(l.selectedUser.email),1)]),s("tr",null,[t[21]||(t[21]=s("th",null,"Role:",-1)),s("td",null,i(l.selectedUser.role),1)]),s("tr",null,[t[22]||(t[22]=s("th",null,"Status:",-1)),s("td",null,i(l.selectedUser.active?"Active":"Inactive"),1)]),s("tr",null,[t[23]||(t[23]=s("th",null,"Joined:",-1)),s("td",null,i(l.selectedUser.joinedDate),1)])])]),s("div",ls,[t[28]||(t[28]=s("h6",null,"Activity Summary",-1)),s("table",os,[s("tr",null,[t[25]||(t[25]=s("th",null,"Last Login:",-1)),s("td",null,i(l.selectedUser.lastLogin),1)]),s("tr",null,[t[26]||(t[26]=s("th",null,"Total Ratings:",-1)),s("td",null,i(l.selectedUser.totalRatings),1)]),s("tr",null,[t[27]||(t[27]=s("th",null,"Comments:",-1)),s("td",null,i(l.selectedUser.totalComments),1)])])])])])):m("",!0),s("div",is,[s("button",{type:"button",class:"btn btn-secondary",onClick:t[2]||(t[2]=(...o)=>n.closeModal&&n.closeModal(...o))},"Close")])])])],2),l.showModal?(d(),a("div",ns)):m("",!0)])}const ds=b(_,[["render",rs],["__scopeId","data-v-bfdd58d8"]]);export{ds as default};
