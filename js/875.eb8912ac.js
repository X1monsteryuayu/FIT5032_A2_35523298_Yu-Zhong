"use strict";(self["webpackChunkhealthypathway"]=self["webpackChunkhealthypathway"]||[]).push([[875],{6875:(e,t,a)=>{a.r(t),a.d(t,{default:()=>te});var n=a(641),l=a(3751),o=a(33),s=a(953),i=a(5220),r=a(7518),c=a(454),u=a(8550);const d={class:"appointment-history-page"},p={class:"container mt-4"},m={class:"row"},h={class:"col-12"},k={class:"card shadow"},v={class:"card-header bg-primary text-white d-flex justify-content-between align-items-center"},g={class:"d-flex gap-2"},L={class:"card-body"},f={class:"row mb-3"},b={class:"col-md-4"},y={class:"input-group"},w={class:"col-md-3"},C={class:"col-md-3"},E={class:"col-md-2"},A={class:"table-responsive"},_={class:"table table-hover"},x={class:"table-dark"},D={key:0},P={key:1},I={class:"badge bg-secondary"},T={class:"d-flex align-items-center"},N={class:"badge bg-info"},S={class:"btn-group btn-group-sm"},W=["onClick"],F=["onClick"],R=["onClick"],M=["onClick"],$={key:0,"aria-label":"Appointment records pagination"},B={class:"pagination justify-content-center"},U=["onClick"],O={class:"d-flex justify-content-between align-items-center mt-3"},K={class:"text-muted"},V={class:"modal-dialog modal-lg"},j={class:"modal-content"},H={key:0,class:"modal-body"},G={class:"row"},X={class:"col-md-6"},J={class:"table table-sm"},Y={class:"badge bg-info"},Q={class:"col-md-6"},z={class:"modal-footer"},q={__name:"AppointmentHistory",setup(e){const t=(0,i.rd)(),a=(0,r.n)(),q=(0,s.KR)([]),Z=(0,s.KR)(!1),ee=(0,s.KR)(""),te=(0,s.KR)(""),ae=(0,s.KR)(""),ne=(0,s.KR)("date"),le=(0,s.KR)("desc"),oe=(0,s.KR)(1),se=(0,s.KR)(10),ie=(0,s.KR)(null),re=(0,s.KR)(null),ce=(0,n.EW)(()=>{let e=q.value;if(ee.value){const t=ee.value.toLowerCase();e=e.filter(e=>e.doctorName.toLowerCase().includes(t)||e.id.toString().includes(t))}return te.value&&(e=e.filter(e=>e.status===te.value)),ae.value&&(e=e.filter(e=>e.type===ae.value)),e}),ue=(0,n.EW)(()=>{const e=[...ce.value];return e.sort((e,t)=>{let a=e[ne.value],n=t[ne.value];return"date"===ne.value?(a=new Date(a),n=new Date(n)):"string"===typeof a&&(a=a.toLowerCase(),n=n.toLowerCase()),"asc"===le.value?a>n?1:-1:a<n?1:-1})}),de=(0,n.EW)(()=>Math.ceil(ue.value.length/se.value)),pe=(0,n.EW)(()=>(oe.value-1)*se.value),me=(0,n.EW)(()=>pe.value+se.value),he=(0,n.EW)(()=>ue.value.slice(pe.value,me.value)),ke=()=>{Z.value=!0,setTimeout(()=>{const e=["Dr. Johnson","Dr. Smith","Dr. Wilson","Dr. Brown","Dr. Chen","Dr. Davis","Dr. Miller","Dr. Garcia"],t=["Confirmed","Completed","Cancelled","Pending"],a=["General Consultation","Follow-up","Surgery Consultation","Health Checkup"],n=["09:00","10:00","11:00","14:00","15:00","16:00"];q.value=Array.from({length:85},(l,o)=>{const s=new Date;return s.setDate(s.getDate()+Math.floor(60*Math.random())-30),{id:1e3+o,doctorName:e[Math.floor(Math.random()*e.length)],date:s.toISOString().split("T")[0],time:n[Math.floor(Math.random()*n.length)],type:a[Math.floor(Math.random()*a.length)],status:t[Math.floor(Math.random()*t.length)],createdAt:new Date(Date.now()-30*Math.random()*24*60*60*1e3).toLocaleString(),notes:Math.random()>.7?"Please arrive 15 minutes early":null,fee:Math.floor(500*Math.random())+100}}),Z.value=!1},800)},ve=()=>{oe.value=1},ge=()=>{oe.value=1},Le=e=>{ne.value===e?le.value="asc"===le.value?"desc":"asc":(ne.value=e,le.value="asc"),oe.value=1},fe=e=>ne.value!==e?"bi bi-arrow-down-up text-muted":"asc"===le.value?"bi bi-arrow-up":"bi bi-arrow-down",be=e=>{e>=1&&e<=de.value&&(oe.value=e)},ye=()=>{oe.value=1},we=()=>{const e=[],t=de.value,a=oe.value;if(t<=7)for(let n=1;n<=t;n++)e.push(n);else if(a<=4){for(let t=1;t<=5;t++)e.push(t);e.push("..."),e.push(t)}else if(a>=t-3){e.push(1),e.push("...");for(let a=t-4;a<=t;a++)e.push(a)}else{e.push(1),e.push("...");for(let t=a-1;t<=a+1;t++)e.push(t);e.push("..."),e.push(t)}return e.filter(t=>"..."!==t||e.indexOf(t)===e.lastIndexOf(t))},Ce=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}),Ee=e=>{switch(e){case"Confirmed":return"bg-primary";case"Completed":return"bg-success";case"Cancelled":return"bg-danger";case"Pending":return"bg-warning";default:return"bg-secondary"}},Ae=e=>{ie.value=e;const t=new c.aF(re.value);t.show()},_e=e=>{confirm("Are you sure you want to reschedule this appointment?")&&t.push({name:"AppointmentBooking",query:{reschedule:e.id}})},xe=e=>{confirm("Are you sure you want to cancel this appointment? This action cannot be undone.")&&(e.status="Cancelled",alert("Appointment has been cancelled"))},De=e=>{const t={id:e.id,patientName:a.user?.displayName||a.user?.email||"Patient",patientEmail:a.user?.email,doctorName:e.doctorName,date:Ce(e.date),time:e.time,type:e.type};(0,u.aA)(t)};return(0,n.sV)(()=>{a.isAuthenticated?ke():t.push("/login")}),(e,t)=>{const a=(0,n.g2)("router-link");return(0,n.uX)(),(0,n.CE)("div",d,[(0,n.Lk)("div",p,[(0,n.Lk)("div",m,[(0,n.Lk)("div",h,[(0,n.Lk)("div",k,[(0,n.Lk)("div",v,[t[16]||(t[16]=(0,n.Lk)("h4",{class:"mb-0"},[(0,n.Lk)("i",{class:"fas fa-history me-2"}),(0,n.eW)(" Appointment History ")],-1)),(0,n.Lk)("div",g,[(0,n.Lk)("button",{class:"btn btn-light btn-sm",onClick:ke},t[14]||(t[14]=[(0,n.Lk)("i",{class:"fas fa-sync-alt me-1"},null,-1),(0,n.eW)(" Refresh Data ",-1)])),(0,n.bF)(a,{to:"/appointment-booking",class:"btn btn-warning btn-sm"},{default:(0,n.k6)(()=>t[15]||(t[15]=[(0,n.Lk)("i",{class:"fas fa-plus-circle me-1"},null,-1),(0,n.eW)(" New Appointment ",-1)])),_:1,__:[15]})])]),(0,n.Lk)("div",L,[(0,n.Lk)("div",f,[(0,n.Lk)("div",b,[(0,n.Lk)("div",y,[t[17]||(t[17]=(0,n.Lk)("span",{class:"input-group-text"},[(0,n.Lk)("i",{class:"fas fa-search"})],-1)),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>ee.value=e),type:"text",class:"form-control",placeholder:"Search doctor name or appointment ID...",onInput:ve},null,544),[[l.Jo,ee.value]])])]),(0,n.Lk)("div",w,[(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>te.value=e),class:"form-select",onChange:ve},t[18]||(t[18]=[(0,n.Fv)('<option value="" data-v-5796437c>All Status</option><option value="Confirmed" data-v-5796437c>Confirmed</option><option value="Completed" data-v-5796437c>Completed</option><option value="Cancelled" data-v-5796437c>Cancelled</option><option value="Pending" data-v-5796437c>Pending</option>',5)]),544),[[l.u1,te.value]])]),(0,n.Lk)("div",C,[(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>ae.value=e),class:"form-select",onChange:ve},t[19]||(t[19]=[(0,n.Fv)('<option value="" data-v-5796437c>All Types</option><option value="General Consultation" data-v-5796437c>General Consultation</option><option value="Follow-up" data-v-5796437c>Follow-up</option><option value="Surgery Consultation" data-v-5796437c>Surgery Consultation</option><option value="Health Checkup" data-v-5796437c>Health Checkup</option>',5)]),544),[[l.u1,ae.value]])]),(0,n.Lk)("div",E,[(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>ne.value=e),class:"form-select",onChange:ge},t[20]||(t[20]=[(0,n.Lk)("option",{value:"date"},"By Date",-1),(0,n.Lk)("option",{value:"doctorName"},"By Doctor",-1),(0,n.Lk)("option",{value:"status"},"By Status",-1)]),544),[[l.u1,ne.value]])])]),(0,n.Lk)("div",A,[(0,n.Lk)("table",_,[(0,n.Lk)("thead",x,[(0,n.Lk)("tr",null,[(0,n.Lk)("th",null,[(0,n.Lk)("button",{class:"btn btn-link text-white p-0",onClick:t[4]||(t[4]=e=>Le("id"))},[t[21]||(t[21]=(0,n.eW)(" Appointment ID ",-1)),(0,n.Lk)("i",{class:(0,o.C4)(fe("id"))},null,2)])]),(0,n.Lk)("th",null,[(0,n.Lk)("button",{class:"btn btn-link text-white p-0",onClick:t[5]||(t[5]=e=>Le("doctorName"))},[t[22]||(t[22]=(0,n.eW)(" Doctor ",-1)),(0,n.Lk)("i",{class:(0,o.C4)(fe("doctorName"))},null,2)])]),(0,n.Lk)("th",null,[(0,n.Lk)("button",{class:"btn btn-link text-white p-0",onClick:t[6]||(t[6]=e=>Le("date"))},[t[23]||(t[23]=(0,n.eW)(" Appointment Date ",-1)),(0,n.Lk)("i",{class:(0,o.C4)(fe("date"))},null,2)])]),(0,n.Lk)("th",null,[(0,n.Lk)("button",{class:"btn btn-link text-white p-0",onClick:t[7]||(t[7]=e=>Le("time"))},[t[24]||(t[24]=(0,n.eW)(" Time ",-1)),(0,n.Lk)("i",{class:(0,o.C4)(fe("time"))},null,2)])]),(0,n.Lk)("th",null,[(0,n.Lk)("button",{class:"btn btn-link text-white p-0",onClick:t[8]||(t[8]=e=>Le("type"))},[t[25]||(t[25]=(0,n.eW)(" Type ",-1)),(0,n.Lk)("i",{class:(0,o.C4)(fe("type"))},null,2)])]),(0,n.Lk)("th",null,[(0,n.Lk)("button",{class:"btn btn-link text-white p-0",onClick:t[9]||(t[9]=e=>Le("status"))},[t[26]||(t[26]=(0,n.eW)(" Status ",-1)),(0,n.Lk)("i",{class:(0,o.C4)(fe("status"))},null,2)])]),t[27]||(t[27]=(0,n.Lk)("th",null,"Actions",-1))])]),(0,n.Lk)("tbody",null,[Z.value?((0,n.uX)(),(0,n.CE)("tr",D,t[28]||(t[28]=[(0,n.Lk)("td",{colspan:"7",class:"text-center py-4"},[(0,n.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,n.Lk)("span",{class:"visually-hidden"},"Loading...")])],-1)]))):0===he.value.length?((0,n.uX)(),(0,n.CE)("tr",P,t[29]||(t[29]=[(0,n.Lk)("td",{colspan:"7",class:"text-center py-4 text-muted"}," No matching appointment records found ",-1)]))):((0,n.uX)(!0),(0,n.CE)(n.FK,{key:2},(0,n.pI)(he.value,e=>((0,n.uX)(),(0,n.CE)("tr",{key:e.id},[(0,n.Lk)("td",null,[(0,n.Lk)("span",I,"#"+(0,o.v_)(e.id),1)]),(0,n.Lk)("td",null,[(0,n.Lk)("div",T,[t[30]||(t[30]=(0,n.Lk)("i",{class:"fas fa-user-md fs-5 text-primary me-2"},null,-1)),(0,n.Lk)("strong",null,(0,o.v_)(e.doctorName),1)])]),(0,n.Lk)("td",null,[t[31]||(t[31]=(0,n.Lk)("i",{class:"fas fa-calendar-alt text-muted me-1"},null,-1)),(0,n.eW)(" "+(0,o.v_)(Ce(e.date)),1)]),(0,n.Lk)("td",null,[t[32]||(t[32]=(0,n.Lk)("i",{class:"fas fa-clock text-muted me-1"},null,-1)),(0,n.eW)(" "+(0,o.v_)(e.time),1)]),(0,n.Lk)("td",null,[(0,n.Lk)("span",N,(0,o.v_)(e.type),1)]),(0,n.Lk)("td",null,[(0,n.Lk)("span",{class:(0,o.C4)(["badge",Ee(e.status)])},(0,o.v_)(e.status),3)]),(0,n.Lk)("td",null,[(0,n.Lk)("div",S,[(0,n.Lk)("button",{class:"btn btn-outline-primary",onClick:t=>Ae(e)},t[33]||(t[33]=[(0,n.Lk)("i",{class:"fas fa-eye me-1"},null,-1),(0,n.eW)(" Details ",-1)]),8,W),"Confirmed"===e.status?((0,n.uX)(),(0,n.CE)("button",{key:0,class:"btn btn-outline-warning",onClick:t=>_e(e)},t[34]||(t[34]=[(0,n.Lk)("i",{class:"fas fa-calendar-alt me-1"},null,-1),(0,n.eW)(" Reschedule ",-1)]),8,F)):(0,n.Q3)("",!0),"Confirmed"===e.status||"Pending"===e.status?((0,n.uX)(),(0,n.CE)("button",{key:1,class:"btn btn-outline-danger",onClick:t=>xe(e)},t[35]||(t[35]=[(0,n.Lk)("i",{class:"fas fa-times me-1"},null,-1),(0,n.eW)(" Cancel ",-1)]),8,R)):(0,n.Q3)("",!0),(0,n.Lk)("button",{class:"btn btn-outline-success",onClick:t=>De(e)},t[36]||(t[36]=[(0,n.Lk)("i",{class:"fas fa-download me-1"},null,-1),(0,n.eW)(" Download ",-1)]),8,M)])])]))),128))])])]),de.value>1?((0,n.uX)(),(0,n.CE)("nav",$,[(0,n.Lk)("ul",B,[(0,n.Lk)("li",{class:(0,o.C4)(["page-item",{disabled:1===oe.value}])},[(0,n.Lk)("button",{class:"page-link",onClick:t[10]||(t[10]=e=>be(oe.value-1))},t[37]||(t[37]=[(0,n.Lk)("i",{class:"fas fa-chevron-left"},null,-1)]))],2),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(we(),e=>((0,n.uX)(),(0,n.CE)("li",{key:e,class:(0,o.C4)(["page-item",{active:e===oe.value}])},[(0,n.Lk)("button",{class:"page-link",onClick:t=>be(e)},(0,o.v_)(e),9,U)],2))),128)),(0,n.Lk)("li",{class:(0,o.C4)(["page-item",{disabled:oe.value===de.value}])},[(0,n.Lk)("button",{class:"page-link",onClick:t[11]||(t[11]=e=>be(oe.value+1))},t[38]||(t[38]=[(0,n.Lk)("i",{class:"fas fa-chevron-right"},null,-1)]))],2)])])):(0,n.Q3)("",!0),(0,n.Lk)("div",O,[(0,n.Lk)("div",K," Showing "+(0,o.v_)(pe.value+1)+"-"+(0,o.v_)(Math.min(me.value,ce.value.length))+" of "+(0,o.v_)(ce.value.length)+" records ",1),(0,n.Lk)("div",null,[(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":t[12]||(t[12]=e=>se.value=e),class:"form-select form-select-sm",onChange:ye},t[39]||(t[39]=[(0,n.Lk)("option",{value:"5"},"5 per page",-1),(0,n.Lk)("option",{value:"10"},"10 per page",-1),(0,n.Lk)("option",{value:"20"},"20 per page",-1),(0,n.Lk)("option",{value:"50"},"50 per page",-1)]),544),[[l.u1,se.value]])])])])])])])]),(0,n.Lk)("div",{class:"modal fade",id:"appointmentModal",tabindex:"-1",ref_key:"appointmentModal",ref:re},[(0,n.Lk)("div",V,[(0,n.Lk)("div",j,[t[56]||(t[56]=(0,n.Lk)("div",{class:"modal-header"},[(0,n.Lk)("h5",{class:"modal-title"},[(0,n.Lk)("i",{class:"fas fa-info-circle me-2"}),(0,n.eW)(" Appointment Details ")]),(0,n.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),ie.value?((0,n.uX)(),(0,n.CE)("div",H,[(0,n.Lk)("div",G,[(0,n.Lk)("div",X,[t[46]||(t[46]=(0,n.Lk)("h6",{class:"text-primary"},"Basic Information",-1)),(0,n.Lk)("table",J,[(0,n.Lk)("tr",null,[t[40]||(t[40]=(0,n.Lk)("td",null,[(0,n.Lk)("strong",null,"Appointment ID:")],-1)),(0,n.Lk)("td",null,"#"+(0,o.v_)(ie.value.id),1)]),(0,n.Lk)("tr",null,[t[41]||(t[41]=(0,n.Lk)("td",null,[(0,n.Lk)("strong",null,"Doctor:")],-1)),(0,n.Lk)("td",null,(0,o.v_)(ie.value.doctorName),1)]),(0,n.Lk)("tr",null,[t[42]||(t[42]=(0,n.Lk)("td",null,[(0,n.Lk)("strong",null,"Date:")],-1)),(0,n.Lk)("td",null,(0,o.v_)(Ce(ie.value.date)),1)]),(0,n.Lk)("tr",null,[t[43]||(t[43]=(0,n.Lk)("td",null,[(0,n.Lk)("strong",null,"Time:")],-1)),(0,n.Lk)("td",null,(0,o.v_)(ie.value.time),1)]),(0,n.Lk)("tr",null,[t[44]||(t[44]=(0,n.Lk)("td",null,[(0,n.Lk)("strong",null,"Type:")],-1)),(0,n.Lk)("td",null,[(0,n.Lk)("span",Y,(0,o.v_)(ie.value.type),1)])]),(0,n.Lk)("tr",null,[t[45]||(t[45]=(0,n.Lk)("td",null,[(0,n.Lk)("strong",null,"Status:")],-1)),(0,n.Lk)("td",null,[(0,n.Lk)("span",{class:(0,o.C4)(["badge",Ee(ie.value.status)])},(0,o.v_)(ie.value.status),3)])])])]),(0,n.Lk)("div",Q,[t[53]||(t[53]=(0,n.Lk)("h6",{class:"text-primary"},"Additional Information",-1)),(0,n.Lk)("p",null,[t[47]||(t[47]=(0,n.Lk)("strong",null,"Booking Time:",-1)),t[48]||(t[48]=(0,n.Lk)("br",null,null,-1)),(0,n.eW)((0,o.v_)(ie.value.createdAt),1)]),(0,n.Lk)("p",null,[t[49]||(t[49]=(0,n.Lk)("strong",null,"Notes:",-1)),t[50]||(t[50]=(0,n.Lk)("br",null,null,-1)),(0,n.eW)((0,o.v_)(ie.value.notes||"None"),1)]),(0,n.Lk)("p",null,[t[51]||(t[51]=(0,n.Lk)("strong",null,"Fee:",-1)),t[52]||(t[52]=(0,n.Lk)("br",null,null,-1)),(0,n.eW)("$"+(0,o.v_)(ie.value.fee||"To be confirmed"),1)])])])])):(0,n.Q3)("",!0),(0,n.Lk)("div",z,[t[55]||(t[55]=(0,n.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close",-1)),(0,n.Lk)("button",{type:"button",class:"btn btn-success",onClick:t[13]||(t[13]=e=>De(ie.value))},t[54]||(t[54]=[(0,n.Lk)("i",{class:"fas fa-download me-2"},null,-1),(0,n.eW)(" Download Confirmation ",-1)]))])])])],512)])}}};var Z=a(6262);const ee=(0,Z.A)(q,[["__scopeId","data-v-5796437c"]]),te=ee},8550:(e,t,a)=>{a.d(t,{JC:()=>c,aA:()=>d,j:()=>u});var n=a(4323);const l={NODE_ENV:"production",VUE_APP_FIREBASE_API_KEY:"demo-key",VUE_APP_FIREBASE_AUTH_DOMAIN:"demo-project.firebaseapp.com",VUE_APP_FIREBASE_PROJECT_ID:"demo-project",VUE_APP_FIREBASE_STORAGE_BUCKET:"demo-project.appspot.com",VUE_APP_FIREBASE_MESSAGING_SENDER_ID:"123456789",VUE_APP_FIREBASE_APP_ID:"demo-app-id",VUE_APP_TITLE:"HealthyPathway",BASE_URL:"/FIT5032_A2_35523298_Yu-Zhong/"}.VUE_APP_EMAIL_API_BASE||"http://localhost:3001",o=e=>{const t=new n["default"];t.setFont("helvetica"),t.setFontSize(20),t.setTextColor(52,152,219),t.text("HEALTHY PATHWAY",20,30),t.setFontSize(16),t.setTextColor(0,0,0),t.text("Appointment Confirmation",20,45),t.setLineWidth(.5),t.line(20,50,190,50),t.setFontSize(12),t.setFont("helvetica","bold"),t.text("APPOINTMENT DETAILS",20,65),t.setFont("helvetica","normal"),t.text(`Patient Name: ${e.patientName}`,20,80),t.text(`Email: ${e.patientEmail}`,20,95),t.text(`Doctor: ${e.doctorName}`,20,110),t.text(`Date: ${e.date}`,20,125),t.text(`Time: ${e.time}`,20,140),t.text(`Type: ${e.type||"General Consultation"}`,20,155),t.text(`Reference ID: ${e.id}`,20,170),e.language&&t.text(`Preferred Language: ${e.language}`,20,185),t.line(20,195,190,195),t.setFont("helvetica","bold"),t.text("IMPORTANT REMINDERS",20,210),t.setFont("helvetica","normal");const a=["• Please arrive 15 minutes before your appointment time","• Bring a valid photo ID and insurance card","• Bring a list of current medications","• Contact us at least 24 hours in advance if you need to reschedule","• Wear a mask and follow health protocols"];let l=225;return a.forEach(e=>{t.text(e,25,l),l+=12}),t.setFont("helvetica","bold"),t.text("CONTACT INFORMATION",20,l+10),t.setFont("helvetica","normal"),t.text("Phone: +1 (555) 123-4567",20,l+25),t.text("Email: info@healthypathway.com",20,l+40),t.text("Website: www.healthypathway.com",20,l+55),t},s=e=>new Promise((t,a)=>{const n=new FileReader;n.onload=()=>t(n.result.split(",")[1]),n.onerror=a,n.readAsDataURL(e)}),i=e=>e?e.replace(/\n/g,"<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;"):"",r=async(e,t=null)=>{try{const n=`${l}/health`;try{const e=new AbortController,t=setTimeout(()=>e.abort(),3e3),a=await fetch(n,{method:"GET",signal:e.signal});if(clearTimeout(t),!a.ok)throw new Error("后端服务器不可用")}catch(a){return console.warn("后端服务器连接失败，启用演示模式:",a),t&&d(t),{success:!0,messageId:"demo-"+Date.now(),demo:!0,message:"演示模式：PDF已生成，实际部署时邮件会正常发送"}}let r=[];if(t){const e=o(t),a=e.output("blob"),n=await s(a);r.push({content:n,filename:`appointment_${t.id}.pdf`,type:"application/pdf"})}const c={to:e.to,toName:e.toName||"Patient",subject:e.subject,htmlContent:e.htmlContent||i(e.message),attachments:r},u=await fetch(`${l}/api/send-email`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),p=await u.json();if(u.ok&&p.success)return console.log("Email sent successfully:",p.messageId),{success:!0,messageId:p.messageId};throw new Error(p.error||"Failed to send email")}catch(n){return console.error("Email sending failed:",n),"TypeError"===n.name||n.message.includes("fetch")?(t&&d(t),{success:!0,messageId:"demo-"+Date.now(),demo:!0,message:"演示模式：实际部署时需要配置邮件服务器"}):{success:!1,error:n.message}}},c=async e=>{const t=`\n    <html>\n      <head>\n        <style>\n          body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; }\n          .header { background-color: #3498db; color: white; padding: 20px; text-align: center; }\n          .content { padding: 20px; }\n          .appointment-details { background-color: #f8f9fa; padding: 15px; border-radius: 5px; margin: 20px 0; }\n          .footer { background-color: #2c3e50; color: white; padding: 20px; text-align: center; }\n          .highlight { color: #3498db; font-weight: bold; }\n          table { width: 100%; border-collapse: collapse; }\n          td { padding: 8px; border-bottom: 1px solid #eee; }\n          .important { background-color: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 5px; margin: 15px 0; }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <h1>🏥 Healthy Pathway</h1>\n          <h2>Appointment Confirmation</h2>\n        </div>\n        \n        <div class="content">\n          <p>Dear <strong>${e.patientName}</strong>,</p>\n          \n          <p>Your appointment has been successfully confirmed! Please find the details below:</p>\n          \n          <div class="appointment-details">\n            <h3>📅 Appointment Details:</h3>\n            <table>\n              <tr><td><strong>Doctor:</strong></td><td>${e.doctorName}</td></tr>\n              <tr><td><strong>Date:</strong></td><td>${e.date}</td></tr>\n              <tr><td><strong>Time:</strong></td><td>${e.time}</td></tr>\n              <tr><td><strong>Type:</strong></td><td>${e.type||"General Consultation"}</td></tr>\n              <tr><td><strong>Reference ID:</strong></td><td class="highlight">${e.id}</td></tr>\n              ${e.language?`<tr><td><strong>Language:</strong></td><td>${e.language}</td></tr>`:""}\n            </table>\n          </div>\n          \n          <div class="important">\n            <h3>⚠️ Important Reminders:</h3>\n            <ul>\n              <li>Please arrive <strong>15 minutes early</strong></li>\n              <li>Bring a valid photo ID and insurance card</li>\n              <li>Bring a list of your current medications</li>\n              <li>Contact us at least 24 hours in advance if you need to reschedule</li>\n              <li>Please wear a mask and follow all health protocols</li>\n            </ul>\n          </div>\n          \n          <p>📎 <strong>Attachment:</strong> A detailed PDF confirmation document is attached to this email for your records.</p>\n          \n          <p>If you have any questions or need to reschedule, please don't hesitate to contact us.</p>\n          \n          <p>Thank you for choosing Healthy Pathway! We look forward to seeing you.</p>\n          \n          <p>Best regards,<br>\n          <strong>The Healthy Pathway Team</strong></p>\n        </div>\n        \n        <div class="footer">\n          <p><strong>📞 Contact Information</strong></p>\n          <p>Phone: +1 (555) 123-4567 | Email: info@healthypathway.com</p>\n          <p>🌐 Website: www.healthypathway.com</p>\n        </div>\n      </body>\n    </html>\n  `,a={to:e.patientEmail,toName:e.patientName,subject:"✅ Appointment Confirmation - Healthy Pathway",htmlContent:t};return await r(a,e)},u=async e=>{try{const a=`${l}/health`;try{const e=new AbortController,t=setTimeout(()=>e.abort(),3e3),n=await fetch(a,{method:"GET",signal:e.signal});if(clearTimeout(t),!n.ok)throw new Error("邮件服务器不可用");console.log("✅ 邮件服务器连接成功，使用真实API发送邮件")}catch(t){return console.warn("⚠️ 邮件服务器连接失败，启用演示模式:",t.message),{success:!0,messageId:"demo-contact-"+Date.now(),demo:!0,message:"演示模式：联系表单已模拟提交成功"}}const n=await fetch(`${l}/api/send-contact`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),timeout:1e4}),o=await n.json();if(n.ok&&o.success)return console.log("📧 联系表单邮件发送成功:",o.messageId),{success:!0,messageId:o.messageId,demo:!1,message:o.message||"邮件发送成功"};throw new Error(o.error||"邮件发送失败")}catch(a){return console.error("❌ 联系表单邮件发送失败:",a),"TypeError"===a.name||"AbortError"===a.name||a.message.includes("fetch")?{success:!0,messageId:"demo-contact-"+Date.now(),demo:!0,message:"演示模式：邮件服务器暂时不可用，已模拟成功发送"}:{success:!1,error:a.message}}},d=e=>{const t=o(e);t.save(`appointment_confirmation_${e.id}.pdf`)}}}]);