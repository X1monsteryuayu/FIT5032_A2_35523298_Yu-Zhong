"use strict";(self["webpackChunkhealthypathway"]=self["webpackChunkhealthypathway"]||[]).push([[604],{6604:(e,t,s)=>{s.r(t),s.d(t,{default:()=>H});var l=s(641),a=s(33),r=s(3751);const i={class:"user-management"},o={class:"container py-5"},n={class:"row g-4 mb-5"},c={class:"col-md-4"},d={class:"card updateUserRole(user) { if (user.role === 'admin' && user.id === this.currentUser?.email) { alert('不能更改自己的管理员角色！'); // 恢复原始角色 user.role = 'admin'; return; } if (updateUserRole(user.email, user.role)) { alert('用户角色更新成功！'); this.loadUsers(); // 重新加载用户列表 } else { alert('更新用户角色失败'); } }, toggleUserStatus(user) { if (user.role === 'admin') { alert('不能禁用管理员账户！'); return; } const newStatus = !user.active; if (updateUserStatus(user.email, newStatus)) { user.active = newStatus; alert(newStatus ? '用户已启用' : '用户已禁用'); } else { alert('更新用户状态失败'); } }, async deleteUser(id) { const user = this.users.find(u => u.id === id); if (!user) return; if (user.role === 'admin') { alert('不能删除管理员账户！'); return; } if (confirm('确定要删除此用户吗？')) { if (deleteUser(user.email)) { this.users = this.users.filter(u => u.id !== id); alert('用户删除成功！'); this.loadUsers(); // 重新加载用户列表 } else { alert('删除用户失败'); } } }ard"},u={class:"card-body"},k={class:"d-flex align-items-center"},L={class:"mb-0"},m={class:"col-md-4"},h={class:"card stat-card"},v={class:"card-body"},b={class:"d-flex align-items-center"},g={class:"mb-0"},f={class:"col-md-4"},p={class:"card stat-card"},U={class:"card-body"},y={class:"d-flex align-items-center"},w={class:"mb-0"},C={class:"card"},S={class:"card-body"},_={class:"d-flex justify-content-between align-items-center mb-4"},x={class:"search-box"},M={class:"table-responsive"},D={class:"table"},I=["onUpdate:modelValue","onChange"],R=["onClick"],E=["onClick"],A=["onClick"],N={class:"modal-dialog modal-lg"},J={class:"modal-content"},Q={class:"modal-header"},j={key:0,class:"modal-body"},O={class:"row"},X={class:"col-md-6"},F={class:"table"},V={class:"col-md-6"},T={class:"table"},Y={class:"modal-footer"},z={key:0,class:"modal-backdrop fade show"};function B(e,t,s,B,K,P){return(0,l.uX)(),(0,l.CE)("div",i,[(0,l.Lk)("div",o,[t[17]||(t[17]=(0,l.Lk)("h1",{class:"text-center mb-5"},"User Management",-1)),(0,l.Lk)("div",n,[(0,l.Lk)("div",c,[(0,l.Lk)("div",d,[(0,l.Lk)("div",u,[t[5]||(t[5]=(0,l.Lk)("h3",{class:"card-title"},"Total Users",-1)),(0,l.Lk)("div",k,[t[4]||(t[4]=(0,l.Lk)("i",{class:"bi bi-people fs-1 me-3 text-primary"},null,-1)),(0,l.Lk)("div",null,[(0,l.Lk)("h2",L,(0,a.v_)(K.statistics.total),1),t[3]||(t[3]=(0,l.Lk)("small",{class:"text-muted"},"注册用户总数",-1))])])])])]),(0,l.Lk)("div",m,[(0,l.Lk)("div",h,[(0,l.Lk)("div",v,[t[8]||(t[8]=(0,l.Lk)("h3",{class:"card-title"},"Active Users",-1)),(0,l.Lk)("div",b,[t[7]||(t[7]=(0,l.Lk)("i",{class:"bi bi-person-check fs-1 me-3 text-success"},null,-1)),(0,l.Lk)("div",null,[(0,l.Lk)("h2",g,(0,a.v_)(K.statistics.active),1),t[6]||(t[6]=(0,l.Lk)("small",{class:"text-muted"},"当前活跃用户",-1))])])])])]),(0,l.Lk)("div",f,[(0,l.Lk)("div",p,[(0,l.Lk)("div",U,[t[11]||(t[11]=(0,l.Lk)("h3",{class:"card-title"},"New Users",-1)),(0,l.Lk)("div",y,[t[10]||(t[10]=(0,l.Lk)("i",{class:"bi bi-person-plus fs-1 me-3 text-info"},null,-1)),(0,l.Lk)("div",null,[(0,l.Lk)("h2",w,(0,a.v_)(K.statistics.new),1),t[9]||(t[9]=(0,l.Lk)("small",{class:"text-muted"},"本月新增",-1))])])])])])]),(0,l.Lk)("div",C,[(0,l.Lk)("div",S,[(0,l.Lk)("div",_,[t[12]||(t[12]=(0,l.Lk)("h3",{class:"card-title mb-0"},"User List",-1)),(0,l.Lk)("div",x,[(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=e=>K.searchQuery=e),placeholder:"Search users..."},null,512),[[r.Jo,K.searchQuery]])])]),(0,l.Lk)("div",M,[(0,l.Lk)("table",D,[t[16]||(t[16]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Name"),(0,l.Lk)("th",null,"Email"),(0,l.Lk)("th",null,"Role"),(0,l.Lk)("th",null,"Status"),(0,l.Lk)("th",null,"Joined Date"),(0,l.Lk)("th",null,"Actions")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(P.filteredUsers,e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id},[(0,l.Lk)("td",null,(0,a.v_)(e.name),1),(0,l.Lk)("td",null,(0,a.v_)(e.email),1),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t=>e.role=t,class:"form-select form-select-sm",onChange:t=>P.updateUserRole(e)},t[13]||(t[13]=[(0,l.Lk)("option",{value:"user"},"User",-1),(0,l.Lk)("option",{value:"admin"},"Admin",-1)]),40,I),[[r.u1,e.role]])]),(0,l.Lk)("td",null,[(0,l.Lk)("span",{class:(0,a.C4)(["badge",e.active?"bg-success":"bg-secondary"]),style:{cursor:"pointer"},onClick:t=>P.toggleUserStatus(e)},(0,a.v_)(e.active?"Active":"Inactive"),11,R)]),(0,l.Lk)("td",null,(0,a.v_)(e.joinedDate),1),(0,l.Lk)("td",null,[(0,l.Lk)("button",{class:"btn btn-sm btn-outline-primary me-2",onClick:t=>P.viewUserDetails(e)},t[14]||(t[14]=[(0,l.Lk)("i",{class:"bi bi-eye"},null,-1)]),8,E),(0,l.Lk)("button",{class:"btn btn-sm btn-outline-danger",onClick:t=>P.deleteUser(e.id)},t[15]||(t[15]=[(0,l.Lk)("i",{class:"bi bi-trash"},null,-1)]),8,A)])]))),128))])])])])])]),(0,l.Lk)("div",{class:(0,a.C4)(["modal fade",{"show d-block":K.showModal}]),tabindex:"-1"},[(0,l.Lk)("div",N,[(0,l.Lk)("div",J,[(0,l.Lk)("div",Q,[t[18]||(t[18]=(0,l.Lk)("h5",{class:"modal-title"},"User Details",-1)),(0,l.Lk)("button",{type:"button",class:"btn-close",onClick:t[1]||(t[1]=(...e)=>P.closeModal&&P.closeModal(...e))})]),K.selectedUser?((0,l.uX)(),(0,l.CE)("div",j,[(0,l.Lk)("div",O,[(0,l.Lk)("div",X,[t[24]||(t[24]=(0,l.Lk)("h6",null,"Basic Information",-1)),(0,l.Lk)("table",F,[(0,l.Lk)("tr",null,[t[19]||(t[19]=(0,l.Lk)("th",null,"Name:",-1)),(0,l.Lk)("td",null,(0,a.v_)(K.selectedUser.name),1)]),(0,l.Lk)("tr",null,[t[20]||(t[20]=(0,l.Lk)("th",null,"Email:",-1)),(0,l.Lk)("td",null,(0,a.v_)(K.selectedUser.email),1)]),(0,l.Lk)("tr",null,[t[21]||(t[21]=(0,l.Lk)("th",null,"Role:",-1)),(0,l.Lk)("td",null,(0,a.v_)(K.selectedUser.role),1)]),(0,l.Lk)("tr",null,[t[22]||(t[22]=(0,l.Lk)("th",null,"Status:",-1)),(0,l.Lk)("td",null,(0,a.v_)(K.selectedUser.active?"Active":"Inactive"),1)]),(0,l.Lk)("tr",null,[t[23]||(t[23]=(0,l.Lk)("th",null,"Joined:",-1)),(0,l.Lk)("td",null,(0,a.v_)(K.selectedUser.joinedDate),1)])])]),(0,l.Lk)("div",V,[t[28]||(t[28]=(0,l.Lk)("h6",null,"Activity Summary",-1)),(0,l.Lk)("table",T,[(0,l.Lk)("tr",null,[t[25]||(t[25]=(0,l.Lk)("th",null,"Last Login:",-1)),(0,l.Lk)("td",null,(0,a.v_)(K.selectedUser.lastLogin),1)]),(0,l.Lk)("tr",null,[t[26]||(t[26]=(0,l.Lk)("th",null,"Total Ratings:",-1)),(0,l.Lk)("td",null,(0,a.v_)(K.selectedUser.totalRatings),1)]),(0,l.Lk)("tr",null,[t[27]||(t[27]=(0,l.Lk)("th",null,"Comments:",-1)),(0,l.Lk)("td",null,(0,a.v_)(K.selectedUser.totalComments),1)])])])])])):(0,l.Q3)("",!0),(0,l.Lk)("div",Y,[(0,l.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:t[2]||(t[2]=(...e)=>P.closeModal&&P.closeModal(...e))},"Close")])])])],2),K.showModal?((0,l.uX)(),(0,l.CE)("div",z)):(0,l.Q3)("",!0)])}function K(){const e=[];for(let s=0;s<localStorage.length;s++){const l=localStorage.key(s);if("healthyPathwayResources"!==l&&"userInfo"!==l)try{const t=JSON.parse(localStorage.getItem(l));t&&t.email&&e.push({id:t.email,name:t.name,email:t.email,role:t.role||"user",active:!1!==t.active,joinedDate:new Date(t.registeredAt).toLocaleDateString("zh-CN"),lastLogin:t.lastLogin||"未登录",totalRatings:t.totalRatings||0,totalComments:t.totalComments||0})}catch(t){console.error("Error parsing user data:",t)}}return e}const P={created(){this.loadUsers()},data(){return{searchQuery:"",showModal:!1,selectedUser:null,users:[],statistics:{total:0,active:0,new:0}}},computed:{filteredUsers(){const e=this.searchQuery.toLowerCase();return this.users.filter(t=>t.name.toLowerCase().includes(e)||t.email.toLowerCase().includes(e)||t.role.toLowerCase().includes(e))}},methods:{loadUsers(){this.users=K(),this.updateStatistics()},updateStatistics(){const e=this.users.length,t=this.users.filter(e=>e.active).length,s=this.users.filter(e=>{const t=new Date(e.joinedDate),s=new Date;return t.getMonth()===s.getMonth()&&t.getFullYear()===s.getFullYear()}).length;this.statistics={total:e,active:t,new:s}},updateUserRole(e){try{const t=JSON.parse(localStorage.getItem(e.email));t&&(t.role=e.role,localStorage.setItem(e.email,JSON.stringify(t)),alert("用户角色更新成功！"))}catch(t){console.error("Error updating user role:",t),alert("更新用户角色失败")}},toggleUserStatus(e){if("admin"!==e.role){e.active=!e.active;try{const t=JSON.parse(localStorage.getItem(e.email));t&&(t.active=e.active,localStorage.setItem(e.email,JSON.stringify(t)),alert(e.active?"用户已启用":"用户已禁用"))}catch(t){console.error("Error updating user status:",t),alert("更新用户状态失败")}}else alert("不能禁用管理员账户！")},viewUserDetails(e){this.selectedUser={...e},this.showModal=!0},closeModal(){this.showModal=!1,this.selectedUser=null},deleteUser(e){confirm("Are you sure you want to delete this user?")&&(this.users=this.users.filter(t=>t.id!==e),alert("User deleted successfully!"))}}};var q=s(6262);const G=(0,q.A)(P,[["render",B],["__scopeId","data-v-d1c1c904"]]),H=G}}]);